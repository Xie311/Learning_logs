# C语言编译过程

[C语言的编译过程详解 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/558783902)

**C 语言的编译过程包括四个步骤：**

1. 预处理
2. 编译
3. 汇编
4. 连接

![None](D:\Study_log\杂项\C语言编译过程.png)

## 一、预处理

**编译过程的第一步预就是预处理，与处理结束后会产生一个后缀为(.i)的临时文件。**

这一步由预处理器完成。预处理器主要完成以下任务。

- 删除所有的注释
- 宏扩展
- 文件包含

### 1.删除所有的注释

预处理器会在编译过程中删除所有注释，因为注释不属于程序代码，它们对程序的运行没有特别作用。

### 2.宏拓展

宏是使用 **#define** 指令定义的一些常量值或表达式。宏调用会导致宏扩展。预处理器创建一个中间文件，其中一些预先编写的汇编级指令替换定义的表达式或常量（基本上是匹配的标记）。为了区分原始指令和宏扩展产生的程序集指令，在每个宏展开语句中添加了一个“+”号。

### 3.文件包含
C语言中的文件包含是在预处理期间*将另一*个包含一些预写代码的文件添加到我们的C程序中。它是使用**#include**指令完成的。在预处理期间包含文件会导致在源代码中添加**文件名**的全部内容，从而替换**#include<文件名>**指令，从而创建新的中间文件。

## 二、编译

C 中的编译阶段使用内置*编译器软件*将 （.i） 临时文件转换为具有汇编级指令（低级代码）的汇编**文件** （.s）。为了提高程序的性能，编译器将中间文件转换为程序集文件。
汇编代码是一种简单的英文语言，用于编写低级指令（在微控制器程序中，我们使用汇编语言）。

**整个程序代码由编译器软件一次性解析（语法分析），并通过终端窗口告诉我们源代码中存在的任何语法错误或警告。**

## 三、组装
**使用汇编程序将程序集级代码（.s 文件）转换为机器可理解的代码（二进制/十六进制形式）。**

汇编程序是一个预先编写的程序，它将汇编代码转换为机器代码。它从程序集代码文件中获取基本指令，并将其转换为特定于计算机类型（称为目标代码）的二进制/十六进制代码。
生成的文件与程序集文件同名，在 DOS 中称为扩展名为 **.obj** **的对象文件**，在 UNIX 操作系统中扩展名为 **.o**。

## 四、链接
链接是将库文件包含在我们的程序中的过程。**库文件**是一些预定义的文件，其中包含机器语言中的函数定义，这些文件的扩展名为.lib。一些未知语句写入我们的操作系统无法理解的对象 （.o/.obj） 文件中。你可以把它理解为一本书，里面有一些你不知道的单词，你会用字典来找到这些单词的含义。同样，我们使用库文件来为对象文件中的一些未知语句赋予意义。链接过程会生成一个**可执行文件**，其扩展名为 **.exe** 在 DOS 中为 .out，在 UNIX 操作系统中为 **.out**。